@page "/"
@attribute [StreamRendering(true)]

@inject ISnackbar Snackbar
@inject WizdleHttpClient WizdleClient

@using Wizdle.Models

<PageTitle>Wizdle | Solve Wordle...</PageTitle>

<style>
    .text-center input {
        text-align: center !important;
    }
</style>

@code
{
    private static readonly string DefaultStyle = "font-weight:bold;padding-bottom:15px;font-size:30px;color:black;border-radius:0px;height:50px;border-style:solid;border-width:3px;";
    private static readonly string CorrectCharStyle = $"{DefaultStyle}width:50px;border-color:{Colors.Green.Default};background:{Colors.Green.Lighten2};";
    private static readonly string MisplacedCharStyle = $"{DefaultStyle}width:50px;border-color:{Colors.Amber.Default};background:{Colors.Amber.Lighten2};";
    private static readonly string ExcludedCharStyle = $"{DefaultStyle}width:300px;border-color:{Colors.Gray.Darken4};background:{Colors.BlueGray.Lighten1};";
}

<MudContainer Fixed="true" style="padding-top: 2rem;" role="main">
    <MudGrid Spacing="3" Justify="Justify.Center">
        <MudImage Src="WizdleTitle.png" Width="200" Height="200" Alt="Wizdle" />
        <MudFlexBreak />
        <MudText Typo="Typo.h1">Correct Letters</MudText>
        <MudFlexBreak />
        <MudItem>
            <MudTextField @bind-Value="_correctChar1"
                          id="tbxCorrect1"
                          aria-label="Correct Letter 1"
                          MaxLength="1"
                          Underline="false"
                          Immediate="true"
                          Class="text-center"
                          T="char"
                          Style="@(CorrectCharStyle)"
                          Variant="Variant.Filled" />
        </MudItem>
        <MudItem>
            <MudTextField @bind-Value="_correctChar2"
                          id="tbxCorrect2"
                          aria-label="Correct Letter 2"
                          MaxLength="1"
                          Underline="false"
                          Immediate="true"
                          Class="text-center"
                          T="char"
                          Style="@(CorrectCharStyle)"
                          Variant="Variant.Filled" />
        </MudItem>
        <MudItem>
            <MudTextField @bind-Value="_correctChar3"
                          id="tbxCorrect3"
                          aria-label="Correct Letter 3"
                          MaxLength="1"
                          Underline="false"
                          Immediate="true"
                          Class="text-center"
                          T="char"
                          Style="@(CorrectCharStyle)"
                          Variant="Variant.Filled" />
        </MudItem>
        <MudItem>
            <MudTextField @bind-Value="_correctChar4"
                          id="tbxCorrect4"
                          aria-label="Correct Letter 4"
                          MaxLength="1"
                          Underline="false"
                          Immediate="true"
                          Class="text-center"
                          T="char"
                          Style="@(CorrectCharStyle)"
                          Variant="Variant.Filled" />
        </MudItem>
        <MudItem>
            <MudTextField @bind-Value="_correctChar5"
                          id="tbxCorrect5"
                          aria-label="Correct Letter 5"
                          MaxLength="1"
                          Underline="false"
                          Immediate="true"
                          Class="text-center"
                          T="char"
                          Style="@(CorrectCharStyle)"
                          Variant="Variant.Filled" />
        </MudItem>
        <MudFlexBreak />
        <MudText Typo="Typo.h1">Misplaced Letters</MudText>
        <MudFlexBreak />
        <MudItem>
            <MudTextField @bind-Value="_misplacedChar1"
                          id="tbxMisplaced1"
                          aria-label="Misplaced Letter 1"
                          MaxLength="1"
                          Underline="false"
                          Immediate="true"
                          Class="text-center"
                          T="char"
                          Style="@(MisplacedCharStyle)"
                          Variant="Variant.Filled" />
        </MudItem>
        <MudItem>
            <MudTextField @bind-Value="_misplacedChar2"
                          id="tbxMisplaced2"
                          aria-label="Misplaced Letter 2"
                          MaxLength="1"
                          Underline="false"
                          Immediate="true"
                          Class="text-center"
                          T="char"
                          Style="@(MisplacedCharStyle)"
                          Variant="Variant.Filled" />
        </MudItem>
        <MudItem>
            <MudTextField @bind-Value="_misplacedChar3"
                          id="tbxMisplaced3"
                          aria-label="Misplaced Letter 3"
                          MaxLength="1"
                          Underline="false"
                          Immediate="true"
                          Class="text-center"
                          T="char"
                          Style="@(MisplacedCharStyle)"
                          Variant="Variant.Filled" />
        </MudItem>
        <MudItem>
            <MudTextField @bind-Value="_misplacedChar4"
                          id="tbxMisplaced4"
                          aria-label="Misplaced Letter 4"
                          MaxLength="1"
                          Underline="false"
                          Immediate="true"
                          Class="text-center"
                          T="char"
                          Style="@(MisplacedCharStyle)"
                          Variant="Variant.Filled" />
        </MudItem>
        <MudItem>
            <MudTextField @bind-Value="_misplacedChar5"
                          id="tbxMisplaced5"
                          aria-label="Misplaced Letter 5"
                          MaxLength="1"
                          Underline="false"
                          Immediate="true"
                          Class="text-center"
                          T="char"
                          Style="@(MisplacedCharStyle)"
                          Variant="Variant.Filled" />
        </MudItem>
        <MudFlexBreak />
        <MudText Typo="Typo.h1">Excluded Letters</MudText>
        <MudFlexBreak />
        <MudItem>
            <MudTextField @bind-Value="_excludedLetters"
                          id="tbxExcludedLetters"
                          aria-label="Excluded Letters"
                          MaxLength="26"
                          Underline="false"
                          Immediate="true"
                          Class="text-center"
                          T="string"
                          Style="@(ExcludedCharStyle)"
                          Variant="Variant.Filled" />
        </MudItem>
        <MudFlexBreak />
        <MudButton id="btnSearch"
            Class="pa-2"
            style="margin-top: 1rem;margin-bottom: 1rem;"
            Size="Size.Large"
            Variant="Variant.Filled"
            EndIcon="@Icons.Material.Filled.Search"
            Color="Color.Secondary"
            OnClick="Solve">Search</MudButton>
        <MudFlexBreak />
        <MudDivider DividerType="DividerType.FullWidth" style="margin-top: 1rem;" />
    </MudGrid>
    <MudGrid Spacing="3" Justify="Justify.FlexStart" style="padding-top: 2rem;margin-bottom: 1rem;">
        <MudText
            aria-label="Response Title"
            Typo="Typo.h1">@_wordsIntro</MudText>
        <MudFlexBreak />
        <MudStack
            id="words"
            Wrap="Wrap.Wrap"
            Row="true">
            @foreach (string word in _wizdleResponse.Words)
            {
                <MudPaper aria-label="Word" Class="mud-theme-primary pa-4 rounded-lg" Elevation="17">@word.ToUpper()</MudPaper>
            }
        </MudStack>
    </MudGrid>
</MudContainer>

@code
{
    private char _correctChar1 { get; set; } = '?';
    private char _correctChar2 { get; set; } = '?';
    private char _correctChar3 { get; set; } = '?';
    private char _correctChar4 { get; set; } = '?';
    private char _correctChar5 { get; set; } = '?';

    private char _misplacedChar1 { get; set; } = '?';
    private char _misplacedChar2 { get; set; } = '?';
    private char _misplacedChar3 { get; set; } = '?';
    private char _misplacedChar4 { get; set; } = '?';
    private char _misplacedChar5 { get; set; } = '?';

    private string _excludedLetters { get; set; } = string.Empty;

    private WizdleResponse _wizdleResponse { get; set; } = new WizdleResponse();

    private string _wordsIntro { get; set; } = string.Empty;

    private async Task Solve()
    {
        var request = new WizdleRequest()
        {
            CorrectLetters = $"{_correctChar1}{_correctChar2}{_correctChar3}{_correctChar4}{_correctChar5}",
            MisplacedLetters = $"{_misplacedChar1}{_misplacedChar2}{_misplacedChar3}{_misplacedChar4}{_misplacedChar5}",
            ExcludeLetters = _excludedLetters,
        };

        _wizdleResponse = await WizdleClient.PostAsync(request);

        foreach (string message in _wizdleResponse.Messages)
        {
            Snackbar.Add(message, Severity.Info, config =>
            {
                config.Icon = Icons.Material.Filled.RemoveRedEye;
                config.ShowCloseIcon = true;
                config.VisibleStateDuration = 5000;
                config.OnClick = sb =>
                {
                    StateHasChanged();
                    return Task.CompletedTask;
                };
            });
        }

        _wordsIntro = _wizdleResponse.Words.Any() ? "Possible Words:" : string.Empty;
    }
}
